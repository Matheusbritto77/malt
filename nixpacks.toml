[phases.setup]
nixPkgs = ["nodejs_22", "pnpm-10_x", "git"]

[phases.install]
# We use --no-frozen-lockfile to bypass the lockfile mismatch error in Nixpacks
cmds = ["pnpm install --no-frozen-lockfile", "pnpm ui:install"]

[phases.build]
cmds = [
  "CLAWDBOT_A2UI_SKIP_MISSING=1 pnpm build",
  "pnpm ui:build"
]

[start]
cmd = "pnpm server"

[variables]
NODE_ENV = "production"
CLAWDBOT_PREFER_PNPM = "1"
# Persistent storage location for Coolify volumes
CLAWDBOT_CONFIG_DIR = "/app/data/.clawdbot"
CLAWDBOT_WORKSPACE_DIR = "/app/data/clawd"
CLAWDBOT_GATEWAY_BIND = "lan"
# Skip analytics/telemetry if any
CI = "true"
